---
title: 'Activitat 1: Exploració i preprocés de dades'
author: "Marc Cervera Rosell"
date: "05-04-2024"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

# 1: Lectura de dades i examinació del tipus de variale

## 1.1 Carregar el fitxer de dades

Llegir el fitxer de dades i consultar el nom de les columnes del fitxer.

```{r}
tryCatch({
  data <- read.csv("pisa2009-1.csv", header = TRUE)
  print("El fitxer s'ha llegit correctament")
}, error = function(e){
  print("ERROR en el moment de llegir el document:",conditionMessage(e), "\n")
})
```

Si per alguna raó el fitxer no es pot llegir, en haver un block tryCatch, es treurà per pantalla un missatge d'error. En cas de poder-se llegir sense problema i que tot vagi bé, a més de llegir-se el fitxer es treurà un missatge per pantalla indicant que el fitxer s'ha llegit correctament.

```{r}
columns <- names(data)
print(columns)
```

## 1.2 Examinar el tipus de vasriables

Indicar quines variables són de naturalesa numèrica, caràcter i categòrica.En cas que el tipus de variable que ha atorgat R no coincideixi amb el tipus que li correspondria, indicar de quines variables es tracta. Considereu que les variables binàries prenen valors 1 o 0. La transformació corresponent, si és necessària, s’aplicarà en els apartats següents, una vegada normalitzades les variables.

```{r}
type <- sapply(data, class)

for (i in seq_along(columns)) {
  cat("La columna",columns[i], "és de tipus", type[i], "\n")
}
```

La funció _sapply_ ens permet obtenir el tipus de dades que hi ha en cada columna. Per a fer més senzilla la visualització de la categoría i el seu tipus, s'utilitza un bucle de tipus _for_ per a treure per pantalla una frase on es relaciona cada categoria amb el seu tipus.

# 2: Normalizació de variables qualitatives (text)

## 2.1 Variable raceeth

Mostreu les categories de la variable raceeth. En cas d’inconsistències o errors, corregiu la informació. A continuació, mostreu el percentatge d’estudiants a cada categoria i dibuixeu un gràfic circular (pie chart).

```{r}
categories_raceeth <- unique(data$raceeth)
print(categories_raceeth)
```

La funció _unique()_ ens permet obtenir els diferents valors únics que hi ha en el conjunt de dades que estem estudiant, en aquest cas, la columna _raceeth_.
```{r}
percentages_rounded <- round(prop.table(table(data$raceeth)) * 100, 2)
for (i in seq_along(categories_raceeth)) {
  cat("La categoria",categories_raceeth[i], "té un percetatge de ", percentages_rounded[i],"%", "\n")
}
```

En aquest últim apartat cal posar èmfasi en que s'han arrodonit els percentatges i per tant no són exactes.

Com s'ha fet enteriorment, per tal de facilitar la visualització dels percentatges, s'ha tret per pantalla una frase amb cada categoria i el tant per cent que representa.

Abans de representar les dades en el diagrama de pastís, es pot observar que en el conjunt de dades hi ha alguns errors. Per exemple: "White", "white", "whit", per tant, abans de representar les dades en el diagrama s'han de rectificar els errors del _dataset_

```{r}
data$raceeth <- gsub("\\bwhite\\b", "White", data$raceeth, ignore.case = TRUE)
data$raceeth <- gsub("\\bwhit\\b", "White", data$raceeth, ignore.case = TRUE)
data$raceeth <- gsub("\\bAssian\\b", "Asian", data$raceeth, ignore.case = TRUE)
data$raceeth <- gsub("\\bAsiann\\b", "Asian", data$raceeth, ignore.case = TRUE)
write.csv(data, "pisa_clean.csv", row.names = FALSE)
print("File has been corrected succesfully")
```
Totes les correccions de les dades qualitatives es guardaràn en el nou fitxer corregit en el qual es guardaràn totes les correccions que anirem fent. Aquest nou fitxer s'anomena _pisa\_clean.csv_
Tornem a repetir els passos de lectura i consulta de les categories però ara amb el fitxer corregit.

```{r}
tryCatch({
  data2 <- read.csv("pisa_clean.csv", header = TRUE)
  print("El fitxer amb les dades corregides s'ha llegit correctament")
}, error = function(e){
  print("ERROR en el moment de llegir el document:",conditionMessage(e), "\n")
})

```
```{r}
categories_raceeth2 <- unique(data2$raceeth)
print(categories_raceeth2)
```
Com es pot obbservar, un cop corregides les categories de la variable qualitativa _raceeth_, apareixen menys categories a representar en el diagrama de pastís.

```{r}
percentages_rounded2 <- round(prop.table(table(data2$raceeth)) * 100, 2)
for (i in seq_along(categories_raceeth2)) {
  cat("La categoria",categories_raceeth2[i], "té un percetatge de ", percentages_rounded2[i],"%", "\n")
}
```
```{r}
percentages_not_rounded_aux <- prop.table(table(data2$raceeth)) * 100
print(percentages_not_rounded_aux)
```
En aquesta última cel·la es veuen els percentatges exactes de les categories un cop corregits els noms mal escrits

```{r}
percentages_not_rounded <- prop.table(table(data2$raceeth)) * 100
pie(percentages_not_rounded, labels=categories_raceeth2)
```
En el diagrama anterior es representen les categories corregides. Com s'observa hi ha una categoria del diagrama que no té etiqueta, això és degut a que en el fitxer csv aquesta categoría correspon a NA.


# 3: Normalització i descripció de variables binàries

```{r}
table_exercise3 <- matrix(data = NA, nrow = 16, ncol = 5)
colnames(table_exercise3) <- c("Variable", "Number of students with value 1", "Number of students with value 0", "Proportion value 1", "Proportion value 0")
variable_names <- c("preschool", "expectBachelors", "motherHS", "motherBachelors", "motherWork", "fatherHS", "fatherBachelors", "fatherWork", "selfBornUS", "motherBornUS", "fatherBornUS", "englishAtHome", "computerForSchoolwork", "schoolHasLibrary", "publicSchool", "urban")
table_exercise3[, 1] <- variable_names
```




